(()=>{"use strict";class e{constructor(){this.baseUrl="https://lernia-sjj-assignments.vercel.app/api"}async loadChallenges(){const e=await fetch(this.baseUrl+"/challenges");return(await e.json()).challenges}async loadTimeSlots(e,t){const n=await fetch(this.baseUrl+`/booking/available-times?challenge=${e.id}&date=${t}`);return(await n.json()).slots}async createBooking(e,t,n,i,s,a){const l={challenge:e.id,participants:parseInt(a),name:t,email:n,date:i,time:s},c=await fetch(this.baseUrl+"/booking/reservations",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});return await c.json()}}class t{constructor(e){this.api=e,this.step=1}render(){return this.dialog=document.createElement("div"),this.dialog.classList.add("modal"),this.dialog.innerText="modal",this.dialog}open(e){this.step=1,this.challenge=e,this.dialog.classList.add("open"),this.update()}update(){if(this.dialog.innerHTML="",1==this.step){this.dialog.innerText="step 1";const e=document.createElement("input");e.type="date",e.value=(new Date).toISOString().slice(0,10),this.dialog.append(e);const t=document.createElement("button");t.innerText="continue",t.addEventListener("click",(async()=>{this.selectedDate=e.value,this.timeSlots=await this.api.loadTimeSlots(this.challenge,this.selectedDate),this.step=2,this.update()})),this.dialog.append(t)}else if(2==this.step){this.dialog.innerText="step 2";const e=document.createElement("select");this.timeSlots.forEach((t=>{const n=document.createElement("option");n.value=t,n.innerText=t,e.append(n)})),this.dialog.append(e);const t=document.createElement("select"),{minParticipants:n,maxParticipants:i}=this.challenge;for(let e=n;e<=i;e++){const n=document.createElement("option");n.value=e,n.innerText=`${e} participants`,t.append(n)}this.dialog.append(t);const s=document.createElement("input");s.placeholder="Name",this.dialog.append(s);const a=document.createElement("input");a.placeholder="E-mail",this.dialog.append(a);const l=document.createElement("button");l.innerText="continue",l.addEventListener("click",(()=>{this.step=3,this.update()})),this.dialog.append(l),l.addEventListener("click",(async()=>{await this.api.createBooking(this.challenge,s.value,a.value,this.selectedDate,e.value,t.value),this.step=3,this.update()}))}else if(3==this.step){this.dialog.innerText="Thank you!";const e=document.createElement("button");e.innerText="close",e.addEventListener("click",(()=>{this.dialog.classList.remove("open")})),this.dialog.append(e)}}}class n extends Event{constructor(e,t){super(e),this.challenge=t}}class i extends EventTarget{constructor(e){super(),this.data=e}render(){const e=document.createElement("li");e.classList.add("challenge-item");const t=document.createElement("div");t.classList.add("challenge-type"),t.innerText=this.data.type,e.append(t);const i=document.createElement("img");i.src=this.data.image,i.alt=this.data.title,i.classList.add("challenge-image"),e.append(i);const s=document.createElement("h3");s.classList.add("challenge-title"),s.innerText=this.data.title,e.append(s);const a=document.createElement("ul");a.role="meter",a.ariaLabel="rating",a.ariaValueMin=0,a.ariaValueMax=5,a.ariaValueNow=this.data.rating,a.ariaValueText=`${this.data.rating} out of 5`,a.classList.add("rating");for(let e=1;e<=5;e++){const t=document.createElement("li");t.classList.add("rating-star"),e<=this.data.rating&&t.classList.add("active"),a.append(t)}e.append(a);const l=document.createElement("small");l.classList.add("challenge-meta"),l.innerText=`${this.data.minParticipants}-${this.data.maxParticipants} participants`,e.append(l);const c=document.createElement("p");c.classList.add("challenge-description"),c.innerText=this.data.description,e.append(c);const d=document.createElement("button");return d.classList.add("button"),d.classList.add("primary"),d.innerText="online"==this.data.type?"Take challenge online":"Book this room",e.append(d),d.addEventListener("click",(()=>{this.dispatchEvent(new n("select",this.data))})),e}}class s extends EventTarget{constructor(e,t){super(),this.api=e,this.filter=t}render(){return this.ul=document.createElement("ul"),this.ul.classList.add("challenge-list"),this.ul}async init(){this.challenges=await this.api.loadChallenges(),this.filter.init(this.challenges),this.filter.addEventListener("change",(()=>{this.update()})),this.update()}update(){const e=this.filter.filter(this.challenges);this.ul.innerHTML="",0!=e.length?e.map((e=>{const t=new i(e);return t.addEventListener("select",(e=>{this.dispatchEvent(new n("select",e.challenge))})),t})).forEach((e=>{const t=e.render();this.ul.append(t)})):this.ul.innerText="No matching challenges"}}class a extends EventTarget{constructor(){super(),this.includeOnline=!0,this.includeOnsite=!0}render(){const e=document.createElement("div"),t=document.createElement("input");t.type="checkbox",t.checked=!0,t.addEventListener("change",(()=>{this.includeOnline=t.checked,this.dispatchEvent(new Event("change"))}));const n=document.createElement("label");n.append(t),n.append("Include online challenges"),e.append(n);const i=document.createElement("input");i.type="checkbox",i.checked=!0,i.addEventListener("change",(()=>{this.includeOnsite=i.checked,this.dispatchEvent(new Event("change"))}));const s=document.createElement("label");return s.append(i),s.append("Include onsite challenges"),e.append(s),e}filter(e){return e.filter((e=>!("online"!=e.type||!this.includeOnline)||!("onsite"!=e.type||!this.includeOnsite)))}}class l extends EventTarget{init(e){this.includedLabels=[];const t=[];e.forEach((e=>{e.labels.forEach((e=>{t.includes(e)||t.push(e)}))})),this.div.innerHTML="",t.forEach((e=>{const t=document.createElement("span");t.innerText=e,t.classList.add("filter-label"),t.addEventListener("click",(()=>{this.includedLabels.includes(e)?(t.classList.remove("active"),this.includedLabels=this.includedLabels.filter((t=>e!==t))):(t.classList.add("active"),this.includedLabels.push(e)),this.dispatchEvent(new Event("change"))})),this.div.append(t)}))}render(){return this.div=document.createElement("div"),this.div.innerText="foo",this.div}filter(e){return e.filter((e=>this.includedLabels.every((t=>e.labels.includes(t)))))}}class c extends EventTarget{constructor(){super(),this.minWidget=new d(0),this.minWidget.addEventListener("change",(()=>{this.minWidget.value>this.maxWidget.value&&this.maxWidget.update(this.minWidget.value),this.dispatchEvent(new Event("change"))})),this.maxWidget=new d(5),this.maxWidget.addEventListener("change",(()=>{this.maxWidget.value<this.minWidget.value&&this.minWidget.update(this.maxWidget.value),this.dispatchEvent(new Event("change"))}))}render(){const e=document.createElement("div"),t=this.minWidget.render();e.append(t);const n=this.maxWidget.render();return e.append(n),e}filter(e){return e.filter((e=>e.rating>=this.minWidget.value&&e.rating<=this.maxWidget.value))}}class d extends EventTarget{constructor(e){super(),this.value=e,this.starElems=[]}update(e){this.value=e;for(let e=0;e<5;e++){const t=e+1;this.starElems[e].classList.toggle("active",t<=this.value)}this.ul.ariaValueNow=this.value,this.ul.ariaValueText=`${this.value} out of 5`}render(){this.ul=document.createElement("ul"),this.ul.role="meter",this.ul.ariaLabel="rating",this.ul.ariaValueMin=0,this.ul.ariaValueMax=5,this.ul.classList.add("rating");for(let e=1;e<=5;e++){const e=document.createElement("li");e.classList.add("rating-star"),this.ul.append(e),this.starElems.push(e)}return this.starElems.forEach(((e,t)=>{e.addEventListener("click",(()=>{0==t&&1==this.value?this.update(0):this.update(t+1),this.dispatchEvent(new Event("change"))}))})),this.update(this.value),this.ul}}class r extends EventTarget{constructor(){super(),this.text=""}render(){const e=document.createElement("div"),t=document.createElement("input");return t.addEventListener("keyup",(()=>{this.text=t.value.toLowerCase(),this.dispatchEvent(new Event("change"))})),e.append(t),e}filter(e){return e.filter((e=>!!e.title.toLowerCase().includes(this.text)||!!e.description.toLowerCase().includes(this.text)))}}class h extends EventTarget{constructor(){super(),this.labelFilter=new l,this.labelFilter.addEventListener("change",(()=>{this.dispatchEvent(new Event("change"))})),this.ratingFilter=new c,this.ratingFilter.addEventListener("change",(()=>{this.dispatchEvent(new Event("change"))})),this.textFilter=new r,this.textFilter.addEventListener("change",(()=>{this.dispatchEvent(new Event("change"))})),this.typeFilter=new a,this.typeFilter.addEventListener("change",(()=>{this.dispatchEvent(new Event("change"))}))}init(e){this.labelFilter.init(e)}render(){const e=document.createElement("div"),t=this.labelFilter.render();e.append(t);const n=this.ratingFilter.render();e.append(n);const i=this.typeFilter.render();e.append(i);const s=this.textFilter.render();return e.append(s),e}filter(e){const t=this.ratingFilter.filter(e),n=this.labelFilter.filter(t),i=this.textFilter.filter(n);return this.typeFilter.filter(i)}}class o extends EventTarget{init(){}filter(e){return e.sort(((e,t)=>t.rating-e.rating)).slice(0,3)}}window.esc={CombinedFilter:h,TopThreeFilter:o,init:(n,i,a)=>{const l=new e,c=new t(l),d=new s(l,n);d.addEventListener("select",(e=>{c.open(e.challenge)})),a||(a=document.body);const r=c.render();a.append(r);const h=d.render();i.append(h),d.init()}}})();